# 📋 รายละเอียดฟีเจอร์ Live x Shop Pro

> เอกสารอธิบายฟีเจอร์ทั้งหมดของระบบ พร้อม Specifications

---

## 📺 ระบบดูดแชท (Chat Capture)

### 1. Facebook Live Chat Capture

| รายการ | รายละเอียด |
|--------|-----------|
| **วิธีการ** | Browser Bot (Puppeteer/Selenium) |
| **ความเร็ว** | Real-time (< 1 วินาที) |
| **ข้อจำกัด** | ต้อง Login Facebook |

#### Flow การทำงาน

```
┌─────────────────────────────────────────────────────────────────┐
│                  FACEBOOK LIVE CHAT CAPTURE                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. ผู้ใช้ใส่ URL ไลฟ์ Facebook                                   │
│     https://www.facebook.com/username/videos/123456              │
│                             │                                    │
│                             ▼                                    │
│  2. Browser Bot เปิดหน้าไลฟ์ (Headless Mode)                      │
│     • Login ด้วย Cookies ที่บันทึกไว้                              │
│     • รอโหลดหน้าจนสำเร็จ                                          │
│                             │                                    │
│                             ▼                                    │
│  3. Inject JavaScript เพื่อ Monitor DOM                          │
│     • ดัก Mutation Observer บน Comment Container                 │
│     • Capture: ชื่อ, รูปโปรไฟล์, ข้อความ, เวลา                     │
│                             │                                    │
│                             ▼                                    │
│  4. ส่งข้อมูลผ่าน WebSocket ไปยัง Main App                        │
│     • Real-time ไม่มี Delay                                      │
│     • รองรับแชทเร็วสูงสุด 1000+ ข้อความ/นาที                       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### ข้อมูลที่ Capture

```csharp
public class ChatMessage
{
    public string UserId { get; set; }        // Facebook User ID
    public string UserName { get; set; }      // ชื่อผู้ใช้
    public string ProfilePicture { get; set; }// รูปโปรไฟล์
    public string Message { get; set; }       // ข้อความ
    public DateTime Timestamp { get; set; }   // เวลา
    public Platform Platform { get; set; }    // = Platform.Facebook
}
```

### 2. TikTok Live Chat Capture

| รายการ | รายละเอียด |
|--------|-----------|
| **วิธีการ** | Browser Bot + WebSocket Intercept |
| **ความเร็ว** | Real-time (< 1 วินาที) |
| **ข้อจำกัด** | ต้อง Login TikTok |

#### Unique Features

- รองรับ Gift Events (ของขวัญ)
- รองรับ Share Events
- รองรับ Follow Events

### 3. LINE OA Chat Capture

| รายการ | รายละเอียด |
|--------|-----------|
| **วิธีการ** | LINE Messaging API |
| **ความเร็ว** | Webhook (< 0.5 วินาที) |
| **ข้อจำกัด** | ต้องมี LINE Official Account |

### 4. Mobile App Chat Capture

> สำหรับกรณีไลฟ์ผ่านมือถือโดยตรง

| รายการ | รายละเอียด |
|--------|-----------|
| **Platform** | Android / iOS (MAUI) |
| **การเชื่อมต่อ** | LAN/WiFi (SignalR) |
| **วิธีการ** | Screen Capture + OCR / Accessibility API |

#### Flow การเชื่อมต่อ

```
┌─────────────────────────────────────────────────────────────────┐
│                    MOBILE APP CONNECTION                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────┐        mDNS Discovery        ┌─────────────┐   │
│  │  📱 Mobile  │◀────────────────────────────▶│  🖥️ Desktop  │   │
│  │     App     │                              │    (Main)    │   │
│  └──────┬──────┘                              └──────┬──────┘   │
│         │                                           │           │
│         │         1. Scan หา Desktop                │           │
│         │            ใน Network เดียวกัน             │           │
│         │                                           │           │
│         │         2. แสดง QR Code                    │           │
│         │◀──────────────────────────────────────────│           │
│         │            สำหรับ Pair                     │           │
│         │                                           │           │
│         │         3. Mobile Scan QR                 │           │
│         │───────────────────────────────────────────▶           │
│         │            ยืนยันการเชื่อมต่อ               │           │
│         │                                           │           │
│         │         4. SignalR Connection             │           │
│         │◀═══════════════════════════════════════════           │
│         │            Established                    │           │
│         │                                           │           │
│         │         5. Stream Chat Messages           │           │
│         │═══════════════════════════════════════════▶           │
│         │            Real-time                      │           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎯 ระบบตรวจจับ CF (CF Detection)

### Pattern Matching

```csharp
// รูปแบบ CF ที่รองรับ
var cfPatterns = new[]
{
    @"^cf\s*(\d+)",           // cf1, cf 2, cf10
    @"^CF\s*(\d+)",           // CF1, CF 2
    @"^ซีเอฟ\s*(\d+)",        // ซีเอฟ1, ซีเอฟ 2
    @"^สั่ง\s*(\d+)",          // สั่ง1, สั่ง 2
    @"^เอา\s*(\d+)",          // เอา1, เอา 2
    @"^(\d+)\s*ชิ้น",          // 1ชิ้น, 2 ชิ้น
    @"^#(\d+)",               // #1, #2
};
```

### รองรับหลายสินค้า

```
ข้อความ: "cf1 2ชิ้น cf3"
ผลลัพธ์: Order 2 items
  - Product #1 x 2
  - Product #3 x 1
```

### Duplicate Detection

```
┌─────────────────────────────────────────────────────────────────┐
│                    DUPLICATE DETECTION                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  Customer: สมชาย                                        │    │
│  │  Message: "cf1"                                         │    │
│  │  Time: 10:00:01                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                             │                                    │
│                             ▼                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  Check: มีออเดอร์ของ สมชาย + สินค้า #1 ในช่วง 5 นาทีไหม?   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                             │                                    │
│              ┌──────────────┴──────────────┐                    │
│              ▼                             ▼                     │
│       ┌──────────────┐             ┌──────────────┐             │
│       │   ❌ ไม่มี    │             │   ✅ มีแล้ว   │             │
│       │  สร้างออเดอร์  │             │    SKIP     │             │
│       └──────────────┘             └──────────────┘             │
│                                                                  │
│  ตัวเลือกการตั้งค่า:                                               │
│  • ช่วงเวลา Duplicate: 1-60 นาที (Default: 5 นาที)                │
│  • เปิด/ปิด Duplicate Check                                      │
│  • เตือนเมื่อพบ Duplicate                                         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 💳 ระบบการเงิน (Payment System)

### 1. OCR สลิป (Slip OCR)

#### รองรับธนาคาร

| ธนาคาร | สถานะ |
|--------|:-----:|
| กสิกรไทย (KBANK) | ✅ |
| ไทยพาณิชย์ (SCB) | ✅ |
| กรุงเทพ (BBL) | ✅ |
| กรุงไทย (KTB) | ✅ |
| กรุงศรี (BAY) | ✅ |
| ออมสิน (GSB) | ✅ |
| ทหารไทยธนชาต (TTB) | ✅ |
| PromptPay | ✅ |

#### ข้อมูลที่อ่านได้

```csharp
public class SlipData
{
    public string BankName { get; set; }       // ชื่อธนาคาร
    public string AccountNumber { get; set; } // เลขบัญชีผู้โอน
    public string AccountName { get; set; }   // ชื่อบัญชีผู้โอน
    public decimal Amount { get; set; }       // จำนวนเงิน
    public DateTime TransferDate { get; set; }// วันที่โอน
    public string ReferenceNo { get; set; }   // เลขอ้างอิง
    public string TransactionId { get; set; } // Transaction ID
}
```

### 2. ตรวจสลิปปลอม (Slip Verification)

```
┌─────────────────────────────────────────────────────────────────┐
│                    SLIP VERIFICATION MODES                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  📋 Mode 1: AUTO (อัตโนมัติ)                             │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  • ตรวจสอบอัตโนมัติทุกสลิป                               │    │
│  │  • ถ้าผ่าน → ยืนยันทันที                                 │    │
│  │  • ถ้าไม่แน่ใจ → ส่งให้แอดมินเช็ค                          │    │
│  │  • ถ้าปลอม → แจ้งเตือน + Block ลูกค้า                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  📋 Mode 2: MANUAL (แอดมินเช็คเอง)                        │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  • ทุกสลิปต้องให้แอดมินยืนยัน                            │    │
│  │  • แสดงคิวสลิปรอตรวจสอบ                                  │    │
│  │  • ความปลอดภัยสูงสุด                                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  📋 Mode 3: HYBRID (ผสม)                                 │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  • ออเดอร์ < 500 บาท → AUTO                              │    │
│  │  • ออเดอร์ >= 500 บาท → MANUAL                           │    │
│  │  • ลูกค้าใหม่ → MANUAL เสมอ                               │    │
│  │  • ลูกค้าประจำ (5+ ออเดอร์) → AUTO                        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### วิธีตรวจสลิปปลอม

```csharp
public class SlipVerificationResult
{
    public bool IsVerified { get; set; }      // ผ่านการตรวจสอบ
    public VerificationStatus Status { get; set; }
    public List<string> Warnings { get; set; }
    public double ConfidenceScore { get; set; } // 0-100%
}

public enum VerificationStatus
{
    Verified,      // ✅ ยืนยันแล้ว
    Suspicious,    // ⚠️ น่าสงสัย (ส่งให้แอดมิน)
    Fake,          // ❌ สลิปปลอม
    Duplicate,     // 🔄 สลิปซ้ำ
    Expired        // ⏰ สลิปเก่าเกินไป
}
```

#### เกณฑ์การตรวจสอบ

| รายการ | คะแนน |
|--------|:-----:|
| QR Code ถูกต้อง | +30 |
| เลขอ้างอิงตรงกับ SMS | +25 |
| จำนวนเงินตรงกับออเดอร์ | +20 |
| วันเวลาสมเหตุสมผล | +10 |
| ไม่พบการแก้ไขภาพ | +15 |
| **รวม** | **100** |

- Score >= 80: ✅ Verified
- Score 50-79: ⚠️ Suspicious
- Score < 50: ❌ Fake

### 3. ตรวจ SMS ธนาคาร

```
┌─────────────────────────────────────────────────────────────────┐
│                    SMS BANK VERIFICATION                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📱 SMS ที่ได้รับ:                                                │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ จาก: KBANK                                              │    │
│  │ รับโอน 1,500.00 บาท                                     │    │
│  │ จาก XXX-X-X1234-X                                       │    │
│  │ เมื่อ 25/12/67 14:30                                    │    │
│  │ ยอดคงเหลือ 10,500.00 บาท                                │    │
│  │ Ref: 2024122514301234                                   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                             │                                    │
│                             ▼                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ ระบบ Parse ข้อมูล:                                       │    │
│  │ • Amount: 1,500.00                                      │    │
│  │ • From: XXX-X-X1234-X                                   │    │
│  │ • Date: 25/12/2567 14:30                                │    │
│  │ • Ref: 2024122514301234                                 │    │
│  └─────────────────────────────────────────────────────────┘    │
│                             │                                    │
│                             ▼                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ Match กับ Order ที่รอชำระ:                               │    │
│  │ ✅ Order #001 - 1,500 บาท → PAID                        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📦 ระบบ POS และสต็อก

### 1. POS System

#### ฟังก์ชันหลัก

- **ขายหน้าร้าน** - สแกน Barcode หรือค้นหาสินค้า
- **รับเงินสด** - คำนวณเงินทอนอัตโนมัติ
- **รับ QR Payment** - แสดง QR Code PromptPay
- **พิมพ์ใบเสร็จ** - Thermal Printer 58mm/80mm
- **เปิด/ปิดกะ** - ระบบ Shift Management

### 2. Stock Management

```csharp
public class Product
{
    public Guid Id { get; set; }
    public string SKU { get; set; }           // รหัสสินค้า
    public string Barcode { get; set; }       // Barcode
    public string Name { get; set; }          // ชื่อสินค้า
    public string Description { get; set; }   // รายละเอียด
    public decimal Price { get; set; }        // ราคาขาย
    public decimal Cost { get; set; }         // ราคาทุน
    public int StockQuantity { get; set; }    // จำนวนในสต็อก
    public int ReorderLevel { get; set; }     // แจ้งเตือนเมื่อต่ำกว่า
    public bool TrackStock { get; set; }      // ติดตามสต็อก
    public bool IsActive { get; set; }        // เปิดใช้งาน
    public List<ProductImage> Images { get; set; }
    public List<ProductVariant> Variants { get; set; }
}
```

### 3. Barcode Support

| ประเภท | รองรับ |
|--------|:-----:|
| EAN-13 | ✅ |
| EAN-8 | ✅ |
| UPC-A | ✅ |
| Code 128 | ✅ |
| Code 39 | ✅ |
| QR Code | ✅ |

---

## 🚚 ระบบขนส่ง (Shipping Integration)

### รองรับขนส่ง

| ขนส่ง | ฟังก์ชัน |
|-------|---------|
| **Kerry Express** | สร้างใบปะหน้า, Track, COD |
| **Flash Express** | สร้างใบปะหน้า, Track, COD |
| **J&T Express** | สร้างใบปะหน้า, Track, COD |
| **ไปรษณีย์ไทย** | สร้างใบปะหน้า, Track |
| **Shopee Express** | Track เท่านั้น |
| **Lazada Express** | Track เท่านั้น |

### Shipping Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                      SHIPPING WORKFLOW                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐        │
│  │  Order Paid │────▶│ Select Ship │────▶│ Print Label │        │
│  └─────────────┘     └─────────────┘     └──────┬──────┘        │
│                                                 │               │
│                                                 ▼               │
│                                          ┌─────────────┐        │
│                                          │  Pack Order │        │
│                                          └──────┬──────┘        │
│                                                 │               │
│                                                 ▼               │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐        │
│  │  Delivered  │◀────│  In Transit │◀────│   Shipped   │        │
│  └─────────────┘     └─────────────┘     └─────────────┘        │
│                                                                  │
│  Tracking Updates: Auto sync ทุก 30 นาที                         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🖥️ หน้าจอห้องแพค (Packing Station)

### ฟีเจอร์

```
┌─────────────────────────────────────────────────────────────────┐
│                    PACKING STATION FEATURES                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📺 Real-time Order Display                                      │
│  ─────────────────────────────────────                          │
│  • แสดงออเดอร์ใหม่ทันทีที่ชำระเงิน                                │
│  • เรียงลำดับตามเวลา หรือ Priority                               │
│  • แสดงรายการสินค้าพร้อมรูปภาพ                                    │
│                                                                  │
│  📦 Order Processing                                             │
│  ─────────────────────────────────────                          │
│  • สแกน Barcode เพื่อยืนยันสินค้า                                 │
│  • Check-off รายการที่แพคแล้ว                                    │
│  • พิมพ์ใบปะหน้าขนส่ง                                             │
│  • อัพเดทสถานะเป็น "Packed"                                      │
│                                                                  │
│  🔗 Connection Options                                           │
│  ─────────────────────────────────────                          │
│  • LAN (Local Network)                                          │
│  • WiFi (Same Network)                                          │
│  • VPN (Remote Location)                                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Mode Selection

เมื่อเปิดโปรแกรม สามารถเลือก Mode:

```
┌────────────────────────────────┐
│  Select Mode                   │
├────────────────────────────────┤
│                                │
│  [ 🖥️ Main Station ]            │
│  เครื่องหลัก - ควบคุมทุกอย่าง   │
│                                │
│  [ 📦 Packing Station ]         │
│  หน้าจอแพคของ - แสดงออเดอร์      │
│                                │
│  [ 🔍 Connect to Main ]         │
│  เชื่อมต่อกับเครื่องหลัก         │
│                                │
└────────────────────────────────┘
```

---

## 🌐 Built-in Web Server

### Customer Portal

```
URL: http://localhost:5000/check
     หรือ http://[IP]:5000/check

┌─────────────────────────────────────────────────────────────────┐
│  🔍 ตรวจสอบสถานะออเดอร์                                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ใส่เลข Tracking หรือเบอร์โทร:                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  EX123456789TH                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                        [ ตรวจสอบ ]                               │
│                                                                  │
│  ────────────────────────────────────────────────────────────   │
│                                                                  │
│  ผลการค้นหา:                                                     │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ Order #001                                              │    │
│  │ สถานะ: 🚚 กำลังจัดส่ง                                    │    │
│  │ Tracking: EX123456789TH (Kerry Express)                 │    │
│  │ อัพเดทล่าสุด: 25/12/67 14:30                            │    │
│  │                                                         │    │
│  │ Timeline:                                               │    │
│  │ ✅ 24/12 สร้างออเดอร์                                    │    │
│  │ ✅ 24/12 ชำระเงินแล้ว                                    │    │
│  │ ✅ 25/12 แพคสินค้าแล้ว                                   │    │
│  │ 🔄 25/12 กำลังจัดส่ง                                     │    │
│  │ ⏳ รอส่งมอบ                                              │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎬 OBS Overlay

### Overlay Types

#### 1. Sales Counter

```
┌─────────────────────────────────┐
│  💰 ยอดขายวันนี้                 │
│  ─────────────────────          │
│  ฿ 15,750                       │
│  25 ออเดอร์                     │
└─────────────────────────────────┘
```

#### 2. Latest Orders

```
┌─────────────────────────────────┐
│  🛒 ออเดอร์ล่าสุด                │
│  ─────────────────────          │
│  สมชาย - เสื้อยืด #3 x2         │
│  สมหญิง - กางเกง #5             │
│  มานี - หมวก #2                 │
└─────────────────────────────────┘
```

#### 3. Product Spotlight

```
┌─────────────────────────────────┐
│  🔥 สินค้าขายดี                  │
│  ─────────────────────          │
│  #1 เสื้อยืด - 15 ชิ้น          │
│  #3 กางเกง - 12 ชิ้น            │
│  #5 หมวก - 8 ชิ้น               │
└─────────────────────────────────┘
```

### OBS Integration

```
URL: http://localhost:5000/overlay/[type]

Types:
• /overlay/sales      - ยอดขาย
• /overlay/orders     - ออเดอร์ล่าสุด
• /overlay/products   - สินค้าขายดี
• /overlay/custom     - Custom (ตั้งค่าได้)
```

---

## 🔐 License System

### Integration with XMan Studio

```
Repository: github.com/xjanova/xmanstudio

┌─────────────────────────────────────────────────────────────────┐
│                    LICENSE MANAGEMENT                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  License Types:                                                  │
│  ─────────────                                                  │
│  • TRIAL - ทดลอง 14 วัน                                         │
│  • BASIC - 1 เครื่อง                                            │
│  • PRO - 3 เครื่อง                                              │
│  • ENTERPRISE - Unlimited                                       │
│                                                                  │
│  Features by License:                                            │
│  ─────────────────────                                          │
│  │ Feature          │ TRIAL │ BASIC │ PRO │ ENT │              │
│  │──────────────────│───────│───────│─────│─────│              │
│  │ ดูดแชท FB        │   ✅   │   ✅   │  ✅  │  ✅  │              │
│  │ ดูดแชท TikTok    │   ✅   │   ✅   │  ✅  │  ✅  │              │
│  │ Mobile App       │   ❌   │   ❌   │  ✅  │  ✅  │              │
│  │ Packing Station  │   ❌   │   ❌   │  ✅  │  ✅  │              │
│  │ OBS Overlay      │   ❌   │   ✅   │  ✅  │  ✅  │              │
│  │ API Access       │   ❌   │   ❌   │  ❌  │  ✅  │              │
│  │ Priority Support │   ❌   │   ❌   │  ✅  │  ✅  │              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

<p align="center">
  <strong>Live x Shop Pro Features</strong><br>
  Version 1.0 | Xman Studio
</p>
